<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Markdown Conversion</title>
    <script src="vendor/turndown/dist/turndown.js"></script>
    <script src="./assets/to-markdown.js"></script>
</head>
<body>
<h2>Test Results</h2>
<div id="results"></div>
<script>
// Simulating PowerPoint HTML content - the body text is plain text, not a table element
const powerPointHtml = `
<!--StartFragment-->


要素 | 功能 | 範例
-- | -- | --
任務 (Task) | 明確說明工作目標 | 「建立一張產品海報」
情境 (Context) | 提供相關事實與限制 | 「產品：化妝品，風格：極簡，目標：年輕女性」
指令 (Instructions) | 具體的規則與步驟 | 「使用柔和光線，產品置於中央，背景純色」
範例 (Examples) | 提供參考樣式 | 「類似 Dior 廣告的質感」
輸出格式 (Output Format) | 指定解析度與比例 | 「4K 解析度，1:1 方形構圖」



<!--EndFragment-->
`;

// Parse the HTML as if pasted
var parser = new DOMParser();
var doc = parser.parseFromString(powerPointHtml, 'text/html');
var body = doc.querySelector('body').innerHTML;

console.log("=== BODY INNER HTML ===");
console.log(body);

// Convert using the pandoc converters (same as in clipboard2markdown.js)
var pandoc = [
    {
      filter: 'h1',
      replacement: function (content, node) {
        return '# ' + content + '\n\n';
      }
    },
    {
      filter: 'h2',
      replacement: function (content, node) {
        return '## ' + content + '\n\n';
      }
    },
    {
      filter: 'sup',
      replacement: function (content) {
        return '^' + content + '^';
      }
    },
    {
      filter: 'sub',
      replacement: function (content) {
        return '~' + content + '~';
      }
    },
    {
      filter: 'br',
      replacement: function () {
        return '\\\n';
      }
    },
    {
      filter: 'hr',
      replacement: function () {
        return '\n\n* * * * *\n\n';
      }
    },
    {
      filter: ['em', 'i', 'cite', 'var'],
      replacement: function (content) {
        return '*' + content + '*';
      }
    },
    {
      filter: function (node) {
        var hasSiblings = node.previousSibling || node.nextSibling;
        var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;
        var isCodeElem = node.nodeName === 'CODE' ||
          node.nodeName === 'KBD' ||
          node.nodeName === 'SAMP' ||
          node.nodeName === 'TT';
        return isCodeElem && !isCodeBlock;
      },
      replacement: function (content) {
        return '\`' + content + '\`';
      }
    },
    {
      filter: function (node) {
        return node.nodeName === 'A' && node.getAttribute('href');
      },
      replacement: function (content, node) {
        var url = node.getAttribute('href');
        var titlePart = node.title ? ' "' + node.title + '"' : '';
        if (content === '') {
          return '';
        } else if (content === url) {
          return '<' + url + '>';
        } else if (url === ('mailto:' + content)) {
          return '<' + content + '>';
        } else {
          return '[' + content + '](' + url + titlePart + ')';
        }
      }
    },
    {
      filter: 'li',
      replacement: function (content, node) {
        content = content.replace(/^\s+/, '').replace(/\n/gm, '\n    ');
        var prefix = '- ';
        var parent = node.parentNode;
        if (/ol/i.test(parent.nodeName)) {
          var index = Array.prototype.indexOf.call(parent.children, node) + 1;
          prefix = index + '. ';
        }
        return prefix + content;
      }
    }
];

var escape = function (str) {
    return str.replace(/[\u2018\u2019\u00b4]/g, "'")
      .replace(/[\u201c\u201d\u2033]/g, '"')
      .replace(/[\u2212\u2022\u00b7\u25aa]/g, '-')
      .replace(/[\u2013\u2015]/g, '--')
      .replace(/\u2014/g, '---')
      .replace(/\u2026/g, '...')
      .replace(/[ ]+\n/g, '\n')
      .replace(/\s*\\\n/g, '\\\n')
      .replace(/\s*\\\n\s*\\\n/g, '\n\n')
      .replace(/\s*\\\n\n/g, '\n\n')
      .replace(/\n-\n/g, '\n')
      .replace(/\n\n\s*\\\n/g, '\n\n')
      .replace(/\n\n\n*/g, '\n\n')
      .replace(/[ ]+$/gm, '')
      .replace(/^\s+|[\s\\]+$/g, '')
      .replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g, ' ')
      .replace(/[\u200B\uFEFF]/g, '');
};

var convert = function (str) {
    return escape(toMarkdown(str, { converters: pandoc, gfm: true }));
};

var result = convert(body);
console.log("=== CONVERTED MARKDOWN ===");
console.log(result);

document.getElementById('results').innerHTML = 
    "<h3>Input body innerHTML:</h3><pre style='background:#f0f0f0;padding:10px'>" + 
    body.replace(/</g, "&lt;") + 
    "</pre><h3>Converted markdown:</h3><pre style='background:#f0f0f0;padding:10px'>" + 
    result + 
    "</pre>";
</script>
</body>
</html>
